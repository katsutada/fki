<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ­¡è¿é é¢</title>
    <script src="pw.js"></script>
    <style>
        body { font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #e6f7ff; }
        .welcome-container { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); text-align: center; }
        h1 { color: #007bff; }
        p { color: #555; }
    </style>
</head>
<body>

<div class="welcome-container">
    <h1>ğŸ‰ æ­¡è¿å›ä¾†ï¼</h1>
    <p>æ‚¨å·²æˆåŠŸç™»å…¥ã€‚æœ¬é é¢é–’ç½® 30 åˆ†é˜å°‡è‡ªå‹•ç™»å‡ºã€‚</p>
    <p id="timerMessage">è¨ˆæ™‚å™¨ç‹€æ…‹ï¼šæ´»å‹•ä¸­ã€‚</p>
</div>

<script>
    // --- 1. é˜²æ­¢ç›´æ¥ç€è¦½ wel.html çš„æª¢æŸ¥ ---
    // æª¢æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰ç™»å…¥æ¨™è¨˜
    if (window.location.pathname.endsWith('wel.html') && localStorage.getItem(LOGIN_STATE_KEY) !== 'true') {
        // å¦‚æœæ˜¯ç›´æ¥è¨ªå• wel.html ä¸”æ²’æœ‰ç™»å…¥ç‹€æ…‹ï¼Œå‰‡å¼·åˆ¶è·³è½‰
        alert('æœªç¶“ç™»å…¥ï¼Œç„¡æ³•ç›´æ¥ç€è¦½æ­¤é é¢ã€‚');
        window.location.replace('login.html');
    }
    
    // å¦‚æœæ˜¯é€é login.html è¼‰å…¥çš„å…§å®¹ï¼Œé€™è£¡çš„æª¢æŸ¥æœƒè·³éï¼Œå› ç‚ºæ­¤æ™‚å·²ç¶“æœ‰ç™»å…¥æ¨™è¨˜ã€‚

    // --- 2. é–’ç½® 30 åˆ†é˜å¾Œå›åˆ° login.html ---
    const TIMEOUT_IN_MS = 30 * 60 * 1000; // 30 åˆ†é˜
    let activityTimer;

    const resetTimer = () => {
        clearTimeout(activityTimer);
        // æ›´æ–°æœ€è¿‘æ´»å‹•æ™‚é–“
        localStorage.setItem(TIMEOUT_KEY, Date.now());
        
        // è¨­ç½®æ–°çš„è¨ˆæ™‚å™¨
        activityTimer = setTimeout(logout, TIMEOUT_IN_MS);
        
        // å¯ä»¥åœ¨é€™è£¡æ›´æ–° UI è¨Šæ¯
        const timerMsg = document.getElementById('timerMessage');
        if(timerMsg) timerMsg.textContent = 'è¨ˆæ™‚å™¨ç‹€æ…‹ï¼šæ´»å‹•ä¸­ã€‚é–’ç½®å°‡æ–¼ 30 åˆ†é˜å¾Œè‡ªå‹•ç™»å‡º...';
    };

    const logout = () => {
        alert('æ‚¨å·²é–’ç½®è¶…é 30 åˆ†é˜ï¼Œå°‡è‡ªå‹•ç™»å‡ºã€‚');
        localStorage.removeItem(LOGIN_STATE_KEY);
        localStorage.removeItem(TIMEOUT_KEY);
        // ç„¡è«–ç•¶å‰ç¶²å€æ˜¯ä»€éº¼ï¼Œå¼·åˆ¶å›åˆ° login.html ä¸¦é‡æ–°è¼‰å…¥
        window.location.replace('login.html');
    };

    // ç›£è½ä½¿ç”¨è€…æ´»å‹•
    ['mousemove', 'mousedown', 'keypress', 'scroll', 'touchstart'].forEach(eventType => {
        document.addEventListener(eventType, resetTimer, true);
    });

    // å•Ÿå‹•è¨ˆæ™‚å™¨
    resetTimer();
    
    // é¡å¤–æª¢æŸ¥ï¼šå¦‚æœç€è¦½å™¨è¢«æœ€å°åŒ–å¾Œå†æ¬¡æ‰“é–‹ï¼Œæª¢æŸ¥å¯¦éš›ç¶“éçš„æ™‚é–“
    document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') {
            const lastActivity = parseInt(localStorage.getItem(TIMEOUT_KEY), 10);
            const now = Date.now();
            if (now - lastActivity > TIMEOUT_IN_MS) {
                logout();
            } else {
                resetTimer(); // é‡æ–°å•Ÿå‹•è¨ˆæ™‚å™¨
            }
        }
    });

</script>

</body>
</html>